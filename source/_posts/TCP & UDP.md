---
title: TCP & UDP
date: 2018-10-04 8:58:57
categories: 
- 计算机网络
tags:
- TCP & UDP
---

TCP和UDP都是传输层协议，但UDP协议并不提供超时重传，出错重传等功能，也就是说其是不可靠的协议。

### TCP

TCP是全双工协议，是可靠的**面向连接协议**，建立TCP连接需要两端三次握手，通过TCP连接传送的数据，无差错，不丢失，不重复。

* **优点：**
  
  传输比UDP可靠。
	
* **缺点：**
  
  比较耗时，实时性差；对系统资源要求较多。每一条TCP连接只能是点到点的。

### UDP

UDP为不可靠的**无连接协议**，数据传输出去，无需连接两端，无需确认是否到达，不保证可靠交付。

* **优点：**

  实时性好，对系统资源要求较少，工作效率比TCP高，适用于对高速传输和实时性有较高的通信或广播通信。支持一对一，一对多，多对一和多对多的交互通信。
  
* **缺点：**

  传输不可靠，易丢包
  

### QQ的网络连接

* **登陆过程**，客户端client采用TCP协议向服务器server发送信息，HTTP协议下载信息。登陆之后，会有一个TCP连接来保持在线状态。

* **向好友发普通消息**，客户端client采用UDP协议，但是需要通过服务器转发。腾讯为了确保传输消息的可靠，采用上层协议来保证可靠传输。如果消息发送失败，客户端会提示消息发送失败，并可重新发送。使用UDP大大提高了消息传输的效率。（QQ对于普通用户是采用UDP协议，对于会员用TCP协议）

* **向好友进行文件传输**，会使用TCP作为可靠传输的保证。

* **QQ语音和QQ视频**，使用UDP，利用UDP的优势延迟较小，保证了时效性。虽然是不可靠传输，意味着如果数据丢失的话，不会有重传，但是用户一般来说可以接受图像稍微模糊一点，声音稍微不清晰一点，不能接受几秒钟的画面和声音延迟。

* **内网里面的两个客户端传文件**，QQ采用的是P2P技术，不需要服务器中转。


### 游戏的网络连接

实时游戏中，UDP以其简单、传输快的优势，取代了TCP。

* 网速提升，UDP丢包率降低

	网速的提升给UDP的稳定性提供可靠网络保障，丢包率很低，如果使用应用层重传，能够确保传输的可靠性。

* TCP复杂的连接较难改进
	TCP为了实现网络通信的可靠性，使用了复杂的拥塞控制算法，建立了繁琐的握手过程，由于TCP内置的系统协议栈中，极难对其进行改进。

* UDP处理丢包比TCP用户体验更好
	采用TCP，一旦发生丢包，TCP会将后续的包缓存起来，等前面的包重传并接收到后再继续发送，延时会越来越大，基于UDP对实时性要求较为严格的情况下，采用自定义重传机制，能够把丢包产生的延迟降到最低，尽量减少网络问题对游戏性造成影响。



